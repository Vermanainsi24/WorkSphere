<!-- ================= KPI SECTION ================= -->

<div class="kpi-grid">

  <mat-card class="kpi-card">
    <h4>Total Requests</h4>
    <h2>{{ totalRequests }}</h2>
  </mat-card>

  <mat-card class="kpi-card warning">
    <h4>Pending Requests</h4>
    <h2>{{ pendingCount }}</h2>
  </mat-card>

  <mat-card class="kpi-card success">
    <h4>Allocated</h4>
    <h2>{{ allocatedCount }}</h2>
  </mat-card>

  <mat-card class="kpi-card info">
    <h4>Returned</h4>
    <h2>{{ returnedCount }}</h2>
  </mat-card>

</div>


<!-- ================= TABLE ================= -->




<mat-card>
  <h2>Recent Requests</h2>

  <table mat-table [dataSource]="requests" class="mat-elevation-z1">

    <!-- Employee Column -->
    <ng-container matColumnDef="employee">
      <th mat-header-cell *matHeaderCellDef> Employee </th>
      <td mat-cell *matCellDef="let r"> {{ r.employeeName }} </td>
    </ng-container>

    <!-- Resource Column -->
    <ng-container matColumnDef="resource">
      <th mat-header-cell *matHeaderCellDef> Resource </th>
      <td mat-cell *matCellDef="let r"> {{ r.resourceName }} </td>
    </ng-container>

    <!-- Priority Column -->
    <ng-container matColumnDef="priority">
      <th mat-header-cell *matHeaderCellDef> Priority </th>
      <td mat-cell *matCellDef="let r">
        <span class="priority-badge"
              [ngClass]="r.priority.toLowerCase()">
          {{ r.priority }}
        </span>
      </td>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef> Requested On </th>
      <td mat-cell *matCellDef="let r">
        {{ r.requestDate | date:'yyyy-MM-dd' }}
      </td>
    </ng-container>

    <!-- STATUS ACTION COLUMN -->
<ng-container matColumnDef="actions">
  <th mat-header-cell *matHeaderCellDef> Change Status </th>
  <td mat-cell *matCellDef="let r">

  <select class="status-dropdown"
        [(ngModel)]="r.status"
        (ngModelChange)="changeStatus(r.requestId, $event)">

  <option value="APPLIED">APPLIED</option>
  <option value="ALLOCATED">ALLOCATED</option>
  <option value="AWAITED">AWAITED</option>
  <option value="RETURNED">RETURNED</option>

</select>

  </td>
</ng-container>


    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>
</mat-card>
